<!doctype html>
<html lang="en">
  <head>      
        <title>Coincidence</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" /> <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <link href="dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="dist/css/custom.css" rel="stylesheet">
        <script src="dist/js/handlebars.min-v4.7.8.js"></script>   
        <script src="dist/js/vanilla.js"></script>
  </head>
    
  <header> 
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <div class="container-fluid">
              <a class="navbar-brand" href="home.html">Coincidence</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarCollapse">
                        <ul class="navbar-nav me-auto mb-2 mb-md-0">
                            <li class="nav-item">
                                <a class="nav-link" aria-current="page" href="home.html">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" href="#">Shop</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="admin.html">Admin</a>
                            </li>
                        </ul>
                        <ul class="navbar-nav mb-2 mb-md-0">
                            <li class="nav-item">
                                <a class="nav-link" href="cart.html">Cart
                                    <svg width="24" height="24" fill="currentColor" class="bi bi-cart" viewBox="0 0 18 18">
                                        <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l1.313 7h8.17l1.313-7zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
                                    </svg>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
 </header>
<main>


<div class="bg"
     style="background-image: url('https://picsum.photos/200');
                        background-size: cover;
                        background-position: center;">

  <div class="container padded">
  <section class="py-5 text-center container">
    <div class="row py-lg-5">
      <div class="col-lg-6 col-md-8 mx-auto">
        <img src="images/logo.jpg" width="400" height="200"></img>
      </div>
    </div>
  </section>

  <div class="offcanvas offcanvas-start" id="more">

    <script id="more_template" type="text/x-handlebars-template">
        <div class="offcanvas-header">
          <h1 class="offcanvas-title">{{name}}</h1>
          <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
          <p>{{description}}</p>
          <img src="{{image}}" class="card-img-top" width="100%" height="100%" alt=""></img>
        </div>
    </script>

    <div id="more"></div>

  </div>

  <div class="modal fade" id="buyModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content" id="buy_modal">

        <script id="buy_modal_template" type="text/x-handlebars-template">
          <div class="modal-header">
            <h5 class="modal-title">{{name}}</h5>
            <button type="button" id="close" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p>{{curValue}}</p>
            <input id="amount">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" id="buy_btn" class="btn btn-primary">Add to Cart!</button>
          </div>
        </script>

        <div id="buy_modal_hb""></div>

      </div>
    </div>
  </div>

  <ul class="list-group pb-3">
    <li class="list-group-item d-flex justify-content-between lh-sm pt-2">
      <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" id="search_bar">
      <button class="btn btn-outline-secondary me-2" id="search_button" type="submit">Search</button>
      <div class="dropdown">
        <button class="btn btn-outline-danger me-2 dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Sort</button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><h6 class="dropdown-header">Sort by (asc):</h6></li>
          <li><a class="dropdown-item" href="javascript:sortShop(0,(c)=>c.name);">Name</a></li>
          <li><a class="dropdown-item" href="javascript:sortShop(0,(c)=>c.curValue);">Value</a></li>
          <li><a class="dropdown-item" href="javascript:sortShop(0,(c)=>c.curRate);">Rate</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><h6 class="dropdown-header">Sort by (desc):</h6></li>
          <li><a class="dropdown-item" href="javascript:sortShop(1,(c)=>c.name);">Name</a></li>
          <li><a class="dropdown-item" href="javascript:sortShop(1,(c)=>c.curValue);">Value</a></li>
          <li><a class="dropdown-item" href="javascript:sortShop(1,(c)=>c.curRate);">Rate</a></li>
        </ul>
      </div>
    </li>
    <li class="list-group-item d-flex justify-content-between lh-sm">
        <div class="album pb-4 pt-1">
          <div class="container">
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" id="items">
      
      
      <script id="shop_item_template" type="text/x-handlebars-template">
      
          {{#each res}}
          <div>
              <div class="col">
                <div class="card shadow-sm">
                  <img src="{{this.image}}" class="card-img-top" width="100%" height="100%" alt="">
                  <div class="card-body">
                    <h5 class="card-title text-center" id="name">{{this.name}}</h5>
                    <p class="card-text">{{this.description}}</p>
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="btn-group">
                        <button type="button" onclick="{{this.buy}}" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#buyModal">Buy</button>
                        <button type="button" onclick="{{this.more}}" class="btn btn-sm btn-outline-secondary" data-bs-toggle="offcanvas" data-bs-target="#more">Learn more!</button>
                      </div>
                      <div style="{{this.color}}">
                      <!--Make responsive; two cards will make the text look weird-->
                          <svg width="16" height="16" fill="currentColor" class="bi bi-activity text-dark" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 2a.5.5 0 0 1 .47.33L10 12.036l1.53-4.208A.5.5 0 0 1 12 7.5h3.5a.5.5 0 0 1 0 1h-3.15l-1.88 5.17a.5.5 0 0 1-.94 0L6 3.964 4.47 8.171A.5.5 0 0 1 4 8.5H.5a.5.5 0 0 1 0-1h3.15l1.88-5.17A.5.5 0 0 1 6 2"/></svg>
                          <a>{{this.curRate}}%</a>
                          <a style="font-size:25px;" id="{{this.id}}-arrow"></a>
                      </div>
                      </div>
                    </div>
                </div>
              </div>
              </div>
              {{/each}}
      
      </script>
      
          </div>
        </div>
      </div>
    </li>
  </ul>

<script>
  const template = Handlebars.compile($ID("shop_item_template").innerHTML);
  const allCoins = getCoins();
  const buy_modal_template = $ID("buy_modal_template");
  const buy_modal_hb = $ID("buy_modal_hb");
  const more_template = $ID("more_template");
  const more = $ID("more");
  

  const renderShop = (coins) => {
    json = []
    let index = 0
    coins.map(function(obj){
      json.push({
          ...obj, 
          color: obj.curRate > 0 ? "color:green;" : "color:red;", 
          buy: "buyFunc(" + obj.id + ")",
          more: "moreFunc(" + obj.id + ")",
        });
    })
    $ID("items").innerHTML = template({res: json});

    for (const coin of coins){
      $ID(coin.id + "-arrow").innerHTML = coin.curRate >= 0 ? "&uarr;" : "&darr;";
    }
  };

  const buyFunc = (id) => {
    render(buy_modal_template, buy_modal_hb, getCoinByID(id));
    $ID("buy_btn").addEventListener("click", 
      () => {
        let val = amount.value
        if(val && val > 0) {
          addOrder({"id": id, "amount": parseInt(val)})
          $ID("close").click();
        } else {
          console.log("NOT ALLOWED")
          // add effect later
        }
      }
    )
  }

  const moreFunc = (id) => {
    render(more_template, more, allCoins[id])
  }

  const sortShop = (asc, val) => {
    const filter = search_bar.value;

    coins = [];
    for(const coin of allCoins)
      if (coin.name.toLowerCase().includes(filter.toLowerCase()))
        coins.push(coin);

    coins.sort((a, b) => (val(a) < val(b)) ^ asc ? -1 : 1);
    renderShop(coins);
  };

  search_button.addEventListener("click", () => sortShop(0,(c)=>c.name));
  search_bar.addEventListener("keydown", (event) => {
    if(event.key === 'Enter'){
      sortShop(0,(c)=>c.name);
    }
  });
  sortShop(0,(c)=>c.name);
</script>

</main>
  <footer class="container">
    <hr class="featurette-divider">
    <p class="float-end"><a href="#">Back to top</a></p>
    <p>&copy; 2024 Coincidence, Inc. &middot; <a href="privacy.html">Privacy</a> &middot; <a href="terms.html">Terms</a> &middot; <a href="cookies.html">Cookies</a></p>
  </footer>

    <script src="dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
