<!doctype html>
<html lang="en">
  <head>      
        <title>Coincidence</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" /> <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <link href="dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="dist/css/custom.css" rel="stylesheet">
        <script src="dist/js/handlebars.min-v4.7.8.js"></script>   
  </head>
    
  <header> 
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="home.html">Coincidence</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                  <ul class="navbar-nav me-auto mb-2 mb-md-0">
                    <li class="nav-item">
                      <a class="nav-link" href="home.html">Home</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link active" aria-current="page" href="#">Shop</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link disabled">Disabled</a>
                    </li>
                  </ul>
                        <form class="d-flex" role="search">
                            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                            <button class="btn btn-outline-success" type="submit">Search</button>
                        </form>
                    </div>
                </div>
            </nav>
 </header>
<main>


<div class="bg"
     style="background-image: url('https://picsum.photos/200');
                        background-size: cover;
                        background-position: center;

  <div class="bg-image" style="background-image: url('https://lorem.picsum/201'); background-size: cover;">

  <div class="container padded">
  <section class="py-5 text-center container">
    <div class="row py-lg-5">
      <div class="col-lg-6 col-md-8 mx-auto">
        <img src="images/logo.jpg" width="400" height="200"></img>
      </div>
    </div>
  </section>

  <div class="offcanvas offcanvas-start" id="more">

    <script id="more_template" type="text/x-handlebars-template">
        <div class="offcanvas-header">
          <h1 class="offcanvas-title">{{name}}</h1>
          <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
          <p>{{description}}</p>
          <img src="{{image}}" class="card-img-top" width="100%" height="100%" alt=""></img>
        </div>
    </script>

    <div></div>

  </div>

  <div class="modal fade" id="buyModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content" id="modal">

        <script id="modal_template" type="text/x-handlebars-template">
                  <div class="modal-header">
                    <h5 class="modal-title">{{name}}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body">
                    <p>RATE, FORM</p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" id="buy-btn" class="btn btn-primary">Buy</button>
                  </div>
        
        </script>

        <div></div>

      </div>
    </div>
  </div>

  <div class="album py-5 ">
    <div class="container">
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" id="items">


<script id="shop_item_template" type="text/x-handlebars-template">

    {{#each res}}
    <div>
        <div class="col">
          <div class="card shadow-sm">
            <img src="{{this.image}}" class="card-img-top" width="100%" height="100%" alt=""></img>
            <div class="card-body">
              <h5 class="card-title" id="name">{{this.name}}</h5>
              <p class="card-text">{{this.description}}</p>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <button type="button" id="{{this.name}}-Buy" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#buyModal">Buy</button>
                  <button type="button" id="{{this.name}}-More" class="btn btn-sm btn-outline-secondary" data-bs-toggle="offcanvas" data-bs-target="#more">Learn more!</button>
                </div>
                <div style="{{this.color}}">
                <!--Make responsive; two cards will make the text look weird-->
                    <svg width="16" height="16" fill="currentColor" class="bi bi-activity text-dark" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 2a.5.5 0 0 1 .47.33L10 12.036l1.53-4.208A.5.5 0 0 1 12 7.5h3.5a.5.5 0 0 1 0 1h-3.15l-1.88 5.17a.5.5 0 0 1-.94 0L6 3.964 4.47 8.171A.5.5 0 0 1 4 8.5H.5a.5.5 0 0 1 0-1h3.15l1.88-5.17A.5.5 0 0 1 6 2"/></svg>
                    <a>{{this.rate}}%</a>
                    <big id="{{this.name}}-Arrow"></big>
                </div>
                </div>
              </div>
          </div>
        </div>
        </div>
        {{/each}}

 </script>

    </div>
  </div>
</div>



<script>
    async function load() {
    const response = await fetch("daten.json", {cache: "no-store"}); 
    // cache disabled for debugging purposes 
    const data = await response.json();
    return data;
  }

  const render_template_item = (template_id, id, objects) => { 
    template = document.getElementById(template_id);
    const html = Handlebars.compile(template.innerHTML)(objects);
    target = template.nextElementSibling
    target.innerHTML = html

  }

    const register_listener = (id, function_call) => {
      button = document.getElementById(id)
      button.addEventListener("click", function_call)
    }

    const build_json = (data) => {
      const str = JSON.stringify(data)
      return JSON.parse(str.substring(0, str.length-1) + ',"color": "' + 
      (str[str.search('"rate":')+7] == "-" ? "color:red;" : "color:green;")
       + '"}')
    }

    const init_shop_item = (json) => {
      const name = json.name
      arrow = document.getElementById(name + "-Arrow")
      arrow.innerHTML = json.rate >= 0 ? "&uarr;" : "&darr;"
      register_listener(name + "-Buy", 
        function() {
          render_template_item("modal_template", "modal", json);
          document.getElementById("buy-btn").addEventListener("click", 
            function() {
              console.log(json.rate)
            })
        })
      register_listener(name + "-More", 
        function() {
          render_template_item("more_template", "more", json)
      })

    }


      load().then(function(result) {      
        json = []
        result.forEach((object) => json.push(build_json(object)))
        items.innerHTML = Handlebars.compile(shop_item_template.innerHTML)({res: json})
        json.forEach((object) => init_shop_item(object))
    })

</script>

</main>
  <footer class="container">
    <hr class="featurette-divider">
    <p class="float-end"><a href="#">Back to top</a></p>
    <p>&copy; 2024 Coincidence, Inc. &middot; <a href="privacy.html">Privacy</a> &middot; <a href="terms.html">Terms</a> &middot; <a href="cookies.html">Cookies</a></p>
  </footer>

    <script src="dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
